<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>http-mvc.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-theme.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApplicationConfig.html">ApplicationConfig</a></li><li><a href="ApplicationOptions.html">ApplicationOptions</a></li><li><i class='ionicons ion-ios-minus'></i><a href="AuthHandler.html">AuthHandler</a><ul class='methods'><li data-type='method'><a href="AuthHandler.html#.createInstance">createInstance</a></li><li data-type='method'><a href="AuthHandler.html#.parseCookies">parseCookies</a></li><li data-type='method'><a href="AuthHandler.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="AuthHandler.html#preExecuteResult">preExecuteResult</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="BasicAuthHandler.html">BasicAuthHandler</a><ul class='methods'><li data-type='method'><a href="BasicAuthHandler.html#.createInstance">createInstance</a></li><li data-type='method'><a href="BasicAuthHandler.html#.parseBasicAuthorization">parseBasicAuthorization</a></li><li data-type='method'><a href="BasicAuthHandler.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="BasicAuthHandler.html#authorizeRequest">authorizeRequest</a></li><li data-type='method'><a href="BasicAuthHandler.html#beginRequest">beginRequest</a></li><li data-type='method'><a href="BasicAuthHandler.html#endRequest">endRequest</a></li><li data-type='method'><a href="BasicAuthHandler.html#mapRequest">mapRequest</a></li><li data-type='method'><a href="BasicAuthHandler.html#postExecuteResult">postExecuteResult</a></li><li data-type='method'><a href="BasicAuthHandler.html#postMapRequest">postMapRequest</a></li><li data-type='method'><a href="BasicAuthHandler.html#preExecuteResult">preExecuteResult</a></li><li data-type='method'><a href="BasicAuthHandler.html#processRequest">processRequest</a></li><li data-type='method'><a href="BasicAuthHandler.html#validateRequest">validateRequest</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="DirectiveEngine.html">DirectiveEngine</a><ul class='methods'><li data-type='method'><a href="DirectiveEngine.html#.createInstance">createInstance</a></li><li data-type='method'><a href="DirectiveEngine.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="DirectiveEngine.html#authorizeRequest">authorizeRequest</a></li><li data-type='method'><a href="DirectiveEngine.html#beginRequest">beginRequest</a></li><li data-type='method'><a href="DirectiveEngine.html#endRequest">endRequest</a></li><li data-type='method'><a href="DirectiveEngine.html#mapRequest">mapRequest</a></li><li data-type='method'><a href="DirectiveEngine.html#postExecuteResult">postExecuteResult</a></li><li data-type='method'><a href="DirectiveEngine.html#postMapRequest">postMapRequest</a></li><li data-type='method'><a href="DirectiveEngine.html#preExecuteResult">preExecuteResult</a></li><li data-type='method'><a href="DirectiveEngine.html#processRequest">processRequest</a></li><li data-type='method'><a href="DirectiveEngine.html#validateRequest">validateRequest</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="EjsEngine.html">EjsEngine</a><ul class='methods'><li data-type='method'><a href="EjsEngine.html#createInstance">createInstance</a></li><li data-type='method'><a href="EjsEngine.html#render">render</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="HttpApplication.html">HttpApplication</a><ul class='methods'><li data-type='method'><a href="HttpApplication.html#.app.document">app.document</a></li><li data-type='method'><a href="HttpApplication.html#controller">controller</a></li><li data-type='method'><a href="HttpApplication.html#createContext">createContext</a></li><li data-type='method'><a href="HttpApplication.html#db">db</a></li><li data-type='method'><a href="HttpApplication.html#decrypt">decrypt</a></li><li data-type='method'><a href="HttpApplication.html#directive">directive</a></li><li data-type='method'><a href="HttpApplication.html#encypt">encypt</a></li><li data-type='method'><a href="HttpApplication.html#execute">execute</a></li><li data-type='method'><a href="HttpApplication.html#executeExternalRequest">executeExternalRequest</a></li><li data-type='method'><a href="HttpApplication.html#executeRequest">executeRequest</a></li><li data-type='method'><a href="HttpApplication.html#extend">extend</a></li><li data-type='method'><a href="HttpApplication.html#getAuthCookie">getAuthCookie</a></li><li data-type='method'><a href="HttpApplication.html#init">init</a></li><li data-type='method'><a href="HttpApplication.html#mapPath">mapPath</a></li><li data-type='method'><a href="HttpApplication.html#onError">onError</a></li><li data-type='method'><a href="HttpApplication.html#processRequest">processRequest</a></li><li data-type='method'><a href="HttpApplication.html#resolveETag">resolveETag</a></li><li data-type='method'><a href="HttpApplication.html#resolveMime">resolveMime</a></li><li data-type='method'><a href="HttpApplication.html#service">service</a></li><li data-type='method'><a href="HttpApplication.html#setAuthCookie">setAuthCookie</a></li><li data-type='method'><a href="HttpApplication.html#start">start</a></li><li data-type='method'><a href="HttpApplication.html#unattended">unattended</a></li><li data-type='method'><a href="HttpApplication.html#unmodifiedRequest">unmodifiedRequest</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="HttpCache.html">HttpCache</a><ul class='methods'><li data-type='method'><a href="HttpCache.html#add">add</a></li><li data-type='method'><a href="HttpCache.html#ensure">ensure</a></li><li data-type='method'><a href="HttpCache.html#get">get</a></li><li data-type='method'><a href="HttpCache.html#init">init</a></li><li data-type='method'><a href="HttpCache.html#remove">remove</a></li><li data-type='method'><a href="HttpCache.html#removeAll">removeAll</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="HttpContext.html">HttpContext</a><ul class='methods'><li data-type='method'><a href="HttpContext.html#cookie">cookie</a></li><li data-type='method'><a href="HttpContext.html#culture">culture</a></li><li data-type='method'><a href="HttpContext.html#currentHandler">currentHandler</a></li><li data-type='method'><a href="HttpContext.html#engine">engine</a></li><li data-type='method'><a href="HttpContext.html#handle">handle</a></li><li data-type='method'><a href="HttpContext.html#handleDelete">handleDelete</a></li><li data-type='method'><a href="HttpContext.html#handleGet">handleGet</a></li><li data-type='method'><a href="HttpContext.html#handlePost">handlePost</a></li><li data-type='method'><a href="HttpContext.html#handlePut">handlePut</a></li><li data-type='method'><a href="HttpContext.html#is">is</a></li><li data-type='method'><a href="HttpContext.html#removeCookie">removeCookie</a></li><li data-type='method'><a href="HttpContext.html#setCookie">setCookie</a></li><li data-type='method'><a href="HttpContext.html#translate">translate</a></li><li data-type='method'><a href="HttpContext.html#unattended">unattended</a></li><li data-type='method'><a href="HttpContext.html#validateAntiForgeryToken">validateAntiForgeryToken</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="HttpDataContext.html">HttpDataContext</a><ul class='methods'><li data-type='method'><a href="HttpDataContext.html#dataTypes">dataTypes</a></li><li data-type='method'><a href="HttpDataContext.html#db">db</a></li><li data-type='method'><a href="HttpDataContext.html#model">model</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="HttpHandler.html">HttpHandler</a><ul class='methods'><li data-type='method'><a href="HttpHandler.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="HttpHandler.html#authorizeRequest">authorizeRequest</a></li><li data-type='method'><a href="HttpHandler.html#beginRequest">beginRequest</a></li><li data-type='method'><a href="HttpHandler.html#endRequest">endRequest</a></li><li data-type='method'><a href="HttpHandler.html#mapRequest">mapRequest</a></li><li data-type='method'><a href="HttpHandler.html#postExecuteResult">postExecuteResult</a></li><li data-type='method'><a href="HttpHandler.html#postMapRequest">postMapRequest</a></li><li data-type='method'><a href="HttpHandler.html#preExecuteResult">preExecuteResult</a></li><li data-type='method'><a href="HttpHandler.html#processRequest">processRequest</a></li><li data-type='method'><a href="HttpHandler.html#validateRequest">validateRequest</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="HttpRoute.html">HttpRoute</a><ul class='methods'><li data-type='method'><a href="HttpRoute.html#data">data</a></li><li data-type='method'><a href="HttpRoute.html#format">format</a></li><li data-type='method'><a href="HttpRoute.html#isMatch">isMatch</a></li><li data-type='method'><a href="HttpRoute.html#parse">parse</a></li></ul></li><li><a href="module-most-web.common.AbstractMethodException.html">AbstractMethodException</a></li><li><a href="module-most-web.common.FileNotFoundException.html">FileNotFoundException</a></li><li><a href="module-most-web.common.HttpBadRequest.html">HttpBadRequest</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.common.HttpException.html">HttpException</a><ul class='methods'><li data-type='method'><a href="module-most-web.common.HttpException.html#.create">create</a></li></ul></li><li><a href="module-most-web.common.HttpForbiddenException.html">HttpForbiddenException</a></li><li><a href="module-most-web.common.HttpMethodNotAllowed.html">HttpMethodNotAllowed</a></li><li><a href="module-most-web.common.HttpNotFoundException.html">HttpNotFoundException</a></li><li><a href="module-most-web.common.HttpServerError.html">HttpServerError</a></li><li><a href="module-most-web.common.HttpUnauthorizedException.html">HttpUnauthorizedException</a></li><li><a href="module-most-web.controllers.HttpBaseController.html">HttpBaseController</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.controllers.HttpDataController.html">HttpDataController</a><ul class='methods'><li data-type='method'><a href="module-most-web.controllers.HttpDataController.html#association">association</a></li><li data-type='method'><a href="module-most-web.controllers.HttpDataController.html#edit">edit</a></li><li data-type='method'><a href="module-most-web.controllers.HttpDataController.html#index">index</a></li><li data-type='method'><a href="module-most-web.controllers.HttpDataController.html#new">new</a></li><li data-type='method'><a href="module-most-web.controllers.HttpDataController.html#remove">remove</a></li><li data-type='method'><a href="module-most-web.controllers.HttpDataController.html#show">show</a></li></ul></li><li><a href="module-most-web.controllers.HttpLookupController.html">HttpLookupController</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.files.AttachmentFileSystemStorage.html">AttachmentFileSystemStorage</a><ul class='methods'><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#copyFrom">copyFrom</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#copyTo">copyTo</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#createReadStream">createReadStream</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#exists">exists</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#find">find</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#findOne">findOne</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#init">init</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#resolvePhysicalPath">resolvePhysicalPath</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#resolveUrl">resolveUrl</a></li><li data-type='method'><a href="module-most-web.files.AttachmentFileSystemStorage.html#save">save</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.files.FileStorage.html">FileStorage</a><ul class='methods'><li data-type='method'><a href="module-most-web.files.FileStorage.html#copyFrom">copyFrom</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#copyTo">copyTo</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#createReadStream">createReadStream</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#exists">exists</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#find">find</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#findOne">findOne</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#init">init</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#remove">remove</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#resolvePhysicalPath">resolvePhysicalPath</a></li><li data-type='method'><a href="module-most-web.files.FileStorage.html#resolveUrl">resolveUrl</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.html.HtmlWriter.html">HtmlWriter</a><ul class='methods'><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#toString">toString</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#write">write</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#writeAttribute">writeAttribute</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#writeAttributes">writeAttributes</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#writeBeginTag">writeBeginTag</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#writeEndTag">writeEndTag</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#writeFullBeginTag">writeFullBeginTag</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#writeText">writeText</a></li><li data-type='method'><a href="module-most-web.html.HtmlWriter.html#writeTo">writeTo</a></li></ul></li><li><a href="module-most-web.mvc.HtmlViewHelper.html">HtmlViewHelper</a></li><li><a href="module-most-web.mvc.HttpContentResult.html">HttpContentResult</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.mvc.HttpController.html">HttpController</a><ul class='methods'><li data-type='method'><a href="module-most-web.mvc.HttpController.html#action">action</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#content">content</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#empty">empty</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#file">file</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#html">html</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#js">js</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#json">json</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#jsvar">jsvar</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#redirect">redirect</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#result">result</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#view">view</a></li><li data-type='method'><a href="module-most-web.mvc.HttpController.html#xml">xml</a></li></ul></li><li><a href="module-most-web.mvc.HttpEmptyResult.html">HttpEmptyResult</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.mvc.HttpFileResult.html">HttpFileResult</a><ul class='methods'><li data-type='method'><a href="module-most-web.mvc.HttpFileResult.html#execute">execute</a></li></ul></li><li><a href="module-most-web.mvc.HttpJavascriptResult.html">HttpJavascriptResult</a></li><li><a href="module-most-web.mvc.HttpJsonResult.html">HttpJsonResult</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.mvc.HttpRedirectResult.html">HttpRedirectResult</a><ul class='methods'><li data-type='method'><a href="module-most-web.mvc.HttpRedirectResult.html#execute">execute</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.mvc.HttpResult.html">HttpResult</a><ul class='methods'><li data-type='method'><a href="module-most-web.mvc.HttpResult.html#execute">execute</a></li><li data-type='method'><a href="module-most-web.mvc.HttpResult.html#status">status</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.mvc.HttpViewContext.html">HttpViewContext</a><ul class='methods'><li data-type='method'><a href="module-most-web.mvc.HttpViewContext.html#$T">$T</a></li><li data-type='method'><a href="module-most-web.mvc.HttpViewContext.html#render">render</a></li><li data-type='method'><a href="module-most-web.mvc.HttpViewContext.html#translate">translate</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.mvc.HttpViewEngine.html">HttpViewEngine</a><ul class='methods'><li data-type='method'><a href="module-most-web.mvc.HttpViewEngine.html#render">render</a></li></ul></li><li><a href="module-most-web.mvc.HttpViewEngineReference.html">HttpViewEngineReference</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.mvc.HttpViewResult.html">HttpViewResult</a><ul class='methods'><li data-type='method'><a href="module-most-web.mvc.HttpViewResult.html#execute">execute</a></li></ul></li><li><a href="module-most-web.mvc.HttpXmlResult.html">HttpXmlResult</a></li><li><i class='ionicons ion-ios-minus'></i><a href="NoopHandler.html">NoopHandler</a><ul class='methods'><li data-type='method'><a href="NoopHandler.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="NoopHandler.html#authorizeRequest">authorizeRequest</a></li><li data-type='method'><a href="NoopHandler.html#beginRequest">beginRequest</a></li><li data-type='method'><a href="NoopHandler.html#createInstance">createInstance</a></li><li data-type='method'><a href="NoopHandler.html#endRequest">endRequest</a></li><li data-type='method'><a href="NoopHandler.html#mapRequest">mapRequest</a></li><li data-type='method'><a href="NoopHandler.html#postExecuteResult">postExecuteResult</a></li><li data-type='method'><a href="NoopHandler.html#postMapRequest">postMapRequest</a></li><li data-type='method'><a href="NoopHandler.html#preExecuteResult">preExecuteResult</a></li><li data-type='method'><a href="NoopHandler.html#processRequest">processRequest</a></li><li data-type='method'><a href="NoopHandler.html#validateRequest">validateRequest</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="PostHandler.html">PostHandler</a><ul class='methods'><li data-type='method'><a href="PostHandler.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="PostHandler.html#authorizeRequest">authorizeRequest</a></li><li data-type='method'><a href="PostHandler.html#beginRequest">beginRequest</a></li><li data-type='method'><a href="PostHandler.html#endRequest">endRequest</a></li><li data-type='method'><a href="PostHandler.html#mapRequest">mapRequest</a></li><li data-type='method'><a href="PostHandler.html#postExecuteResult">postExecuteResult</a></li><li data-type='method'><a href="PostHandler.html#postMapRequest">postMapRequest</a></li><li data-type='method'><a href="PostHandler.html#preExecuteResult">preExecuteResult</a></li><li data-type='method'><a href="PostHandler.html#processRequest">processRequest</a></li><li data-type='method'><a href="PostHandler.html#validateRequest">validateRequest</a></li></ul></li><li><a href="RouteParamsHandler.html">RouteParamsHandler</a></li><li><i class='ionicons ion-ios-minus'></i><a href="StaticHandler.html">StaticHandler</a><ul class='methods'><li data-type='method'><a href="StaticHandler.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="StaticHandler.html#authorizeRequest">authorizeRequest</a></li><li data-type='method'><a href="StaticHandler.html#beginRequest">beginRequest</a></li><li data-type='method'><a href="StaticHandler.html#endRequest">endRequest</a></li><li data-type='method'><a href="StaticHandler.html#mapPath">mapPath</a></li><li data-type='method'><a href="StaticHandler.html#mapRequest">mapRequest</a></li><li data-type='method'><a href="StaticHandler.html#postExecuteResult">postExecuteResult</a></li><li data-type='method'><a href="StaticHandler.html#postMapRequest">postMapRequest</a></li><li data-type='method'><a href="StaticHandler.html#preExecuteResult">preExecuteResult</a></li><li data-type='method'><a href="StaticHandler.html#processRequest">processRequest</a></li><li data-type='method'><a href="StaticHandler.html#validateRequest">validateRequest</a></li></ul></li><li><a href="UnknownPropertyDescriptor.html">UnknownPropertyDescriptor</a></li><li><i class='ionicons ion-ios-minus'></i><a href="UnknownValue.html">UnknownValue</a><ul class='methods'><li data-type='method'><a href="UnknownValue.html#.convert">convert</a></li><li data-type='method'><a href="UnknownValue.html#.convert">convert</a></li><li data-type='method'><a href="UnknownValue.html#.extend">extend</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="ViewHandler.html">ViewHandler</a><ul class='methods'><li data-type='method'><a href="ViewHandler.html#authenticateRequest">authenticateRequest</a></li><li data-type='method'><a href="ViewHandler.html#authorizeRequest">authorizeRequest</a></li><li data-type='method'><a href="ViewHandler.html#beginRequest">beginRequest</a></li><li data-type='method'><a href="ViewHandler.html#createInstance">createInstance</a></li><li data-type='method'><a href="ViewHandler.html#endRequest">endRequest</a></li><li data-type='method'><a href="ViewHandler.html#mapRequest">mapRequest</a></li><li data-type='method'><a href="ViewHandler.html#postExecuteResult">postExecuteResult</a></li><li data-type='method'><a href="ViewHandler.html#postMapRequest">postMapRequest</a></li><li data-type='method'><a href="ViewHandler.html#preExecuteResult">preExecuteResult</a></li><li data-type='method'><a href="ViewHandler.html#processRequest">processRequest</a></li><li data-type='method'><a href="ViewHandler.html#validateRequest">validateRequest</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="XFormsEngine.html">XFormsEngine</a><ul class='methods'><li data-type='method'><a href="XFormsEngine.html#render">render</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-most-web.html">most-web</a></li></ul><h3>Namespaces</h3><ul><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.common.html">common</a><ul class='methods'><li data-type='method'><a href="module-most-web.common.html#.convertFromBase26">convertFromBase26</a></li><li data-type='method'><a href="module-most-web.common.html#.convertToBase26">convertToBase26</a></li><li data-type='method'><a href="module-most-web.common.html#.debug">debug</a></li><li data-type='method'><a href="module-most-web.common.html#.httpError">httpError</a></li><li data-type='method'><a href="module-most-web.common.html#.isEmptyString">isEmptyString</a></li><li data-type='method'><a href="module-most-web.common.html#.isFunction">isFunction</a></li><li data-type='method'><a href="module-most-web.common.html#.isHttpException">isHttpException</a></li><li data-type='method'><a href="module-most-web.common.html#.isNullOrUndefined">isNullOrUndefined</a></li><li data-type='method'><a href="module-most-web.common.html#.isNumber">isNumber</a></li><li data-type='method'><a href="module-most-web.common.html#.isObject">isObject</a></li><li data-type='method'><a href="module-most-web.common.html#.isRelativeUrl">isRelativeUrl</a></li><li data-type='method'><a href="module-most-web.common.html#.log">log</a></li><li data-type='method'><a href="module-most-web.common.html#.newGuid">newGuid</a></li><li data-type='method'><a href="module-most-web.common.html#.parseBoolean">parseBoolean</a></li><li data-type='method'><a href="module-most-web.common.html#.parseCookies">parseCookies</a></li><li data-type='method'><a href="module-most-web.common.html#.parseFloat">parseFloat</a></li><li data-type='method'><a href="module-most-web.common.html#.parseForm">parseForm</a></li><li data-type='method'><a href="module-most-web.common.html#.parseInt">parseInt</a></li><li data-type='method'><a href="module-most-web.common.html#.parseValue">parseValue</a></li><li data-type='method'><a href="module-most-web.common.html#.randomChars">randomChars</a></li><li data-type='method'><a href="module-most-web.common.html#.randomHex">randomHex</a></li><li data-type='method'><a href="module-most-web.common.html#.randomInt">randomInt</a></li></ul></li><li><a href="module-most-web.controllers.html">controllers</a></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.files.html">files</a><ul class='methods'><li data-type='method'><a href="module-most-web.files.html#.createFileSystemStorage">createFileSystemStorage</a></li></ul></li><li><i class='ionicons ion-ios-minus'></i><a href="module-most-web.html.html">html</a><ul class='methods'><li data-type='method'><a href="module-most-web.html.html#.createHtmlWriter">createHtmlWriter</a></li><li data-type='method'><a href="module-most-web.html.html#.createInstance">createInstance</a></li></ul></li><li><a href="module-most-web.mvc.html">mvc</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">http-mvc.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * MOST Web Framework
 * A JavaScript Web Framework
 * http://themost.io
 *
 * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com, Anthi Oikonomou anthioikonomou@gmail.com
 *
 * Released under the BSD3-Clause license
 * Date: 2014-06-10
 */
'use strict';
/**
 * @ignore
 */
var common = require('./common'),
    util = require('util'),
    htmlWriter = require('./html'),
    xml = require('most-xml'),
    path = require('path'),
    da = require("most-data"),
    fs = require('fs'),
    crypto = require('crypto'),
    async = require('async');
/**
 * @class
 * @constructor
 * @memberOf module:most-web.mvc
 */
function HttpResult() {
    this.contentType = 'text/html';
    this.contentEncoding = 'utf8';
}
/**
 *
 * @param {Number=} status
 */
HttpResult.prototype.status = function(status) {
    this.responseStatus = status;
    return this;
};

/**
 * Executes an HttpResult instance against an existing HttpContext.
 * @param {HttpContext} context
 * @param {Function} callback
 * */
HttpResult.prototype.execute = function(context, callback) {
    callback = callback || function() {};
    try {
        var response = context.response;
        if (typeof this.data === 'undefined' || this.data == null) {
            response.writeHead(204);
            return callback.call(context);
        }
        response.writeHead(this.responseStatus || 200, {"Content-Type": this.contentType});
       if (this.data)
            response.write(this.data, this.contentEncoding);
        callback.call(context);
    }
    catch(e) {
        callback.call(context, e);
    }
};
/**
 * Represents a user-defined content type that is a result of an action.
 * @class HttpContentResult
 * @param {string} content
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 * */
function HttpContentResult(content) {

    this.data = content;
    this.contentType = 'text/html';
    this.contentEncoding = 'utf8';
}
/**
 * Inherits HttpAction
 * */
util.inherits(HttpContentResult,HttpResult);

/**
 * Represents a content that does nothing.
 * @class HttpEmptyResult
 * @constructor
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 */
function HttpEmptyResult() {
    //
}

/**
 * Inherits HttpAction
 * */
util.inherits(HttpEmptyResult,HttpResult);

HttpEmptyResult.prototype.execute = function(context, callback)
{
    //do nothing
    callback = callback || function() {};
    callback.call(context);
};
/**
 * @param {string} key
 * @param {*} value
 * @returns {*}
 * @private
 */
function _json_ignore_null_replacer(key, value) {
    if (value==null)
        return undefined;
    return value;
}

/**
 * Represents an action that is used to send JSON-formatted content.
 * @class HttpJsonResult
 * @param {*} data
 * @constructor
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 */
function HttpJsonResult(data)
{
    if (data instanceof String)
        this.data = data;
    else {
        this.data = JSON.stringify(data, _json_ignore_null_replacer);
    }

    this.contentType = 'application/json;charset=utf-8';
    this.contentEncoding = 'utf8';
}
/**
 * Inherits HttpAction
 * */
util.inherits(HttpJsonResult,HttpResult);

/**
 * Represents an action that is used to send Javascript-formatted content.
 * @class HttpJavascriptResult
 * @param {*} data
 * @constructor
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 */
function HttpJavascriptResult(data)
{
    if (typeof data === 'string')
        this.data = data;
    this.contentType = 'text/javascript;charset=utf-8';
    this.contentEncoding = 'utf8';
}
/**
 * Inherits HttpAction
 * */
util.inherits(HttpJavascriptResult,HttpResult);


/**
 * Represents an action that is used to send XML-formatted content.
 * @class
 * @param data
 * @constructor
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 */
function HttpXmlResult(data)
{

    this.contentType = 'text/xml';
    this.contentEncoding = 'utf8';
    if (typeof data === 'undefined' || data == null)
        return;
    if (typeof data === 'object')
        this.data= xml.serialize(data, { item:'Item' }).outerXML();
    else
        this.data=data;
}

/**
 * Inherits HttpAction
 * */
util.inherits(HttpXmlResult,HttpResult);

/**
 * Represents a redirect action to a specified URI.
 * @class HttpRedirectResult
 * @param {string|*} url
 * @constructor
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 */
function HttpRedirectResult(url) {
    this.url = url;
}

/**
 * Inherits HttpAction
 * */
util.inherits(HttpRedirectResult,HttpResult);
/**
 *
 * @param {HttpContext} context
 * @param {Function} callback
 */
HttpRedirectResult.prototype.execute = function(context, callback)
{
    /**
     * @type ServerResponse
     * */
    var response = context.response;
    response.writeHead(302, { 'Location': this.url });
    //response.end();
    callback.call(context);
};

/**
 * Represents a static file result
 * @class HttpFileResult
 * @param {string} physicalPath
 * @param {string=} fileName
 * @constructor
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 */
function HttpFileResult(physicalPath, fileName) {
    //
    this.physicalPath = physicalPath;
    this.fileName = fileName;
}

/**
 * Inherits HttpAction
 * */
util.inherits(HttpFileResult,HttpResult);
/**
 *
 * @param {HttpContext} context
 * @param {Function} callback
 */
HttpFileResult.prototype.execute = function(context, callback)
{
    callback = callback || function() {};
    var physicalPath = this.physicalPath, fileName = this.fileName,  app = require('./index');
    fs.exists(physicalPath, function(exists) {
        if (!exists) {
            callback(new app.common.HttpNotFoundException());
        }
        else {
            try {
                fs.stat(physicalPath, function (err, stats) {
                    if (err) {
                        callback(err);
                    }
                    else {
                        if (!stats.isFile()) {
                            callback(new app.common.HttpNotFoundException());
                        }
                        else {
                            //get if-none-match header
                            var requestETag = context.request.headers['if-none-match'];
                            //generate responseETag
                            var md5 = crypto.createHash('md5');
                            md5.update(stats.mtime.toString());
                            var responseETag = md5.digest('base64');
                            if (requestETag) {
                                if (requestETag == responseETag) {
                                    context.response.writeHead(304);
                                    context.response.end();
                                    callback();
                                    return;
                                }
                            }
                            var contentType = null;
                            //get file extension
                            var extensionName = path.extname(fileName || physicalPath);
                            //get MIME collection
                            var web = require('./index')
                            var mimes = app.current.config.mimes;
                            var contentEncoding = null;
                            //find MIME type by extension
                            var mime = mimes.filter(function (x) {
                                return x.extension == extensionName;
                            })[0];
                            if (mime) {
                                contentType = mime.type;
                                if (mime.encoding)
                                    contentEncoding = mime.encoding;
                            }

                            //throw exception (MIME not found or access denied)
                            if (web.common.isNullOrUndefined(contentType)) {
                                callback(new app.common.HttpForbiddenException())
                            }
                            else {
                                /*//finally process request
                                fs.readFile(physicalPath, 'binary', function (err, data) {
                                    if (err) {
                                        callback(e);
                                    }
                                    else {
                                        //add Content-Disposition: attachment; filename="&lt;file name.ext>"
                                        context.response.writeHead(200, {
                                            'Content-Type': contentType + (contentEncoding ? ';charset=' + contentEncoding : ''),
                                            'ETag': responseETag
                                        });
                                        context.response.write(data, "binary");
                                        callback();
                                    }
                                });*/
                                //create read stream
                                var source = fs.createReadStream(physicalPath);
                                //add Content-Disposition: attachment; filename="&lt;file name.ext>"
                                context.response.writeHead(200, {
                                    'Content-Type': contentType + (contentEncoding ? ';charset=' + contentEncoding : ''),
                                    'ETag': responseETag
                                });
                                //copy file
                                source.pipe(context.response);
                                source.on('end', function() {
                                    callback();
                                });
                                source.on('error', function(err) {
                                    callback(err);
                                });
                            }
                        }
                    }
                });
            }
            catch (e) {
                callback(e);
            }
        }
    });

};
/**
 * @param controller
 * @param view
 * @param extension
 * @param callback
 * @returns {*}
 * @private
 */
function queryDefaultViewPath(controller, view, extension, callback) {
   return queryAbsoluteViewPath.call(this, this.application.mapPath('/views'), controller, view, extension, callback);
}
/**
 * @param view
 * @param extension
 * @param callback
 * @returns {*}
 * @private
 */
function querySharedViewPath(view, extension, callback) {
    return queryAbsoluteViewPath.call(this, this.application.mapPath('/views'), 'shared', view, extension, callback);
}

/**
 * @param search
 * @param controller
 * @param view
 * @param extension
 * @param callback
 * @private
 */
function queryAbsoluteViewPath(search, controller, view, extension, callback) {
    var self = this,
        result = path.resolve(search, util.format('%s/%s.html.%s', controller, view, extension));
    fs.exists(result, function(exists) {
        if (exists)
            return callback(null, result);
        //search for capitalized controller name e.g. person as Person
        var capitalizedController = controller.charAt(0).toUpperCase() + controller.substring(1);
        result = path.resolve(search, util.format('%s/%s.html.%s', capitalizedController, view, extension));
        fs.exists(result, function(exists) {
            if (exists)
                return callback(null, result);
            callback();
        });
    });
}
/**
 * @param {string} p
 * @returns {boolean}
 * @private
 */
function isAbsolute(p) {
    //var re = new RegExp('^' + p, 'i');
    //return re.test(path.resolve(process.cwd(), p));
    return path.normalize(p + '/') === path.normalize(path.resolve(p) + '/');
}

/**
 * Represents a class that is used to render a view.
 * @class
 * @param {string=} name - The name of the view.
 * @param {Array=} data - The data that are going to be used to render the view.
 * @augments HttpResult
 * @memberOf module:most-web.mvc
 */
function HttpViewResult(name, data)
{
    this.name = name;
    this.data = data==undefined? []: data;
    this.contentType = 'text/html';
    this.contentEncoding = 'utf8';
}

/**
 * Inherits HttpAction
 * */
util.inherits(HttpViewResult,HttpResult);
/**
 * @param {function(Error=,*=)} callback
 * @param {HttpContext} context - The HTTP context
 * */
HttpViewResult.prototype.execute = function(context, callback)
{
    var self = this;
    callback = callback || function() {};
    var app = require('./index'),
        array = require('most-array'),
        util = require('util'),
        fs = require('fs');
    /**
     * @type ServerResponse
     * */
    var response = context.response;
    //if the name is not defined get the action name of the current controller
    if (!this.name)
        //get action name
        this.name = context.data['action'];
    //validate [path] route param in order to load a view that is located in a views' sub-directory (or in another absolute path)
    var routePath;
    if (context.request.route) {
        routePath =  context.request.route.path || context.request.route.data("path");
    }
    //get view name
    var viewName = this.name;
    if (/^partial/.test(viewName)) {
        //partial view
        viewName = viewName.substr(7).replace(/^-/,'');
        context.request.route.partial = true;
    }

    //and of course controller's name
    var controllerName = context.data['controller'];
    //enumerate existing view engines e.g /views/controller/index.[html].ejs or /views/controller/index.[html].xform etc.
    /**
     * {HttpViewEngineReference|*}
     */
    var viewPath, viewEngine;
    async.eachSeries(app.current.config.engines, function(engine, cb) {
        if (viewPath) { cb(); return; }
        if (routePath &amp;&amp; isAbsolute(routePath)) {
            queryAbsoluteViewPath.call(context, routePath, controllerName, viewName, engine.extension, function(err, result) {
                if (err) { return cb(err); }
                if (result) {
                    viewPath = result;
                    viewEngine = engine;
                    return cb();
                }
                else {
                    return cb();
                }
            });
        }
        else {
            var searchViewName = viewName;
            if (routePath) {
                searchViewName = path.join(routePath, viewName);
            }
            //search by relative path
            queryDefaultViewPath.call(context, controllerName, searchViewName, engine.extension, function(err, result) {
                if (err) { return cb(err); }
                if (result) {
                    viewPath = result;
                    viewEngine = engine;
                    return cb();
                }
                else {
                    querySharedViewPath.call(context, searchViewName, engine.extension, function(err, result) {
                        if (err) { return cb(err); }
                        if (result) {
                            viewPath = result;
                            viewEngine = engine;
                            return cb();
                        }
                        cb();
                    });
                }
            });
        }

    }, function(err) {
        if (err) { callback(err); return; }
        if (viewEngine) {
            var engine = require(viewEngine.type);
            /**
             * @type {HttpViewEngine|*}
             */
            var engineInstance = engine.createInstance(context);
            //render
            var e = { context:context, target:self };
            context.emit('preExecuteResult', e, function(err) {
                if (err) {
                    callback(err);
                }
                else {
                    engineInstance.render(viewPath, self.data, function(err, result) {
                        if (err) {
                            callback.call(context, err);
                        }
                        else {
                            //HttpViewResult.result or data (?)
                            self.result = result;
                            context.emit('postExecuteResult', e, function(err) {
                                if (err) {
                                    callback.call(context, err);
                                }
                                else {
                                    response.writeHead(200, {"Content-Type": self.contentType});
                                    response.write(self.result, self.contentEncoding);
                                    callback.call(context);
                                }
                            });
                        }
                    });
                }
            });

        }
        else {
            callback.call(context, new common.HttpNotFoundException('View Not Found'));
        }
    });




};


/**
 * @classdesc Provides methods that respond to HTTP requests that are made to a web application
 * @class
 * @constructor
 * @param {HttpContext} context - The executing HTTP context.
 * @property {HttpContext} context - Gets or sets the HTTP context associated with this controller
 * @property {string} name - Gets or sets the internal name for this controller
 * @memberOf module:most-web.mvc
 * */
function HttpController(context) {
    this.context = context;
}

/**
 * Creates a view result object for the given request.
 * @param {*=} data
 * @returns {module.HttpViewResult}
 */
HttpController.prototype.view = function(data)
{
    return new HttpViewResult(null, data);
}

/**
 * Creates a view result based on the context content type
 * @param {*=} data
 * @returns HttpViewResult
 * */
HttpController.prototype.result = function(data)
{
    if (this.context) {
         var fn = this[this.context.format];
        if (typeof fn !== 'function')
            throw new common.HttpException(400,'Not implemented.');
        return fn.call(this, data);
    }
    else
        throw new Error('Http context cannot be empty at this context.');
};

HttpController.prototype.forbidden = function (callback) {
    callback(new common.HttpForbiddenException());
};

/**
 * Creates a view result object for the given request.
 * @param {*=} data
 * @returns HttpViewResult
 * */
HttpController.prototype.html = function(data)
{
    return new HttpViewResult(null, data);
};
/**
 * Creates a view result object for the given request.
 * @param {*=} data
 * @returns HttpViewResult
 * */
HttpController.prototype.htm = HttpController.prototype.html;

/**
 * Creates a view result object for the given request.
 * @param {String=} data
 * @returns HttpJavascriptResult
 * */
HttpController.prototype.js = function(data)
{
    return new HttpJavascriptResult(data);
}

/**
 * Creates a view result object that represents a client javascript object.
 * This result may be used for sharing specific objects stored in memory or server filesystem
 * e.g. serve a *.json file as a client variable with name window.myVar1 or
 * serve user settings object ({ culture: 'en-US', notifyMe: false}) as a variable with name window.settings
 * @param {String} name
 * @param {String|*} obj
 * @returns HttpResult
 * */
HttpController.prototype.jsvar = function(name, obj)
{
    if (typeof name !== 'string')
        return new HttpEmptyResult();
    if (name.length==0)
        return new HttpEmptyResult();
    if (typeof obj === 'undefined' || obj == null)
        return new HttpJavascriptResult(name.concat(' = null;'));
    else if (obj instanceof Date)
        return new HttpJavascriptResult(name.concat(' = new Date(', obj.valueOf(), ');'));
    else if (typeof obj === 'string')
        return new HttpJavascriptResult(name.concat(' = ', obj, ';'));
    else
        return new HttpJavascriptResult(name.concat(' = ', JSON.stringify(obj), ';'));
};

/**
 * Invokes a default action and returns an HttpViewResult instance
 * @param {String} action
 * @param {Function} callback
 */
HttpController.prototype.action = function(callback)
{
    callback(null, this.view());
}

/**
 * Creates a content result object by using a string.
 * @returns HttpContentResult
 * */
HttpController.prototype.content = function(content)
{
     return new HttpContentResult(content);
}
/**
 * Creates a JSON result object by using the specified data.
 * @returns HttpJsonResult
 * */
HttpController.prototype.json = function(data)
{
    return new HttpJsonResult(data);
}

/**
 * Creates a XML result object by using the specified data.
 * @returns HttpXmlResult
 * */
HttpController.prototype.xml = function(data)
{
    return new HttpXmlResult(data);
}

/**
 * Creates a binary file result object by using the specified path.
 * @param {string}  physicalPath
 * @param {string=}  fileName
 * @returns {HttpFileResult|HttpResult}
 * */
HttpController.prototype.file = function(physicalPath, fileName)
{
    return new HttpFileResult(physicalPath, fileName);
}

/**
 * Creates a redirect result object that redirects to the specified URL.
 * @returns HttpRedirectResult
 * */
HttpController.prototype.redirect = function(url)
{
    return new HttpRedirectResult(url);
}

/**
 * Creates an empty result object.
 * @returns HttpEmptyResult
 * */
HttpController.prototype.empty = function()
{
    return new HttpEmptyResult();
}
/**
 * Abstract view engine class
 * @class HttpViewEngine
 * @param {HttpContext} context
 * @constructor
 * @augments {EventEmitter}
 * @memberOf module:most-web.mvc
 */
function HttpViewEngine(context) {
    //
}
util.inherits(HttpViewEngine, da.types.EventEmitter2);

/**
 * Renders the specified view with the options provided
 * @param url
 * @param options
 */
HttpViewEngine.prototype.render = function(url, options, callback) {
    //
}


/**
 * Defines an HTTP view engine in application configuration
 * @class
 * @constructor
 * @memberOf module:most-web.mvc
 */
function HttpViewEngineReference()
{
    /**
     * Gets or sets the class associated with an HTTP view engine
     * @type {String}
     */
    this.type = null;
    /**
     * Gets or sets the name of an HTTP view engine
     * @type {String}
     */
    this.name = null;
    /**
     * Gets or sets the layout extension associated with an HTTP view engine
     * @type {null}
     */
    this.extension = null;
}

/**
 * Encapsulates information that is related to rendering a view.
 * @class
 * @param {HttpContext} context
 * @property {DataModel} model
 * @property {HtmlWriter} html
 * @constructor
 * @augments {EventEmitter}
 * @memberOf module:most-web.mvc
 */
function HttpViewContext(context) {
    /**
     * Gets or sets the body of the current view
     * @type {String}
     */
    this.body='';
    /**
     * Gets or sets the title of the page if the view will be fully rendered
     * @type {String}
     */
    this.title='';
    /**
     * Gets or sets the view layout page if the view will be fully rendered
     * @type {String}
     */
    this.layout = null;
    /**
     * Gets or sets the view data
     * @type {String}
     */
    this.data = null;
    /**
     * Represents the current HTTP context
     * @type {HttpContext}
     */
    this.context = context;

    /**
     * @type {HtmlWriter}
     */
    this.writer = undefined;

    var writer = null;
    Object.defineProperty(this, 'writer', {
        get:function() {
            if (writer)
                return writer;
            writer = htmlWriter.createInstance();
            writer.indent = false;
            return writer;
        }, configurable:false, enumerable:false
    });

    var self = this;
    Object.defineProperty(this, 'model', {
        get:function() {
            if (self.context.params)
                if (self.context.params.controller)
                    return self.context.model(self.context.params.controller);
            return null;
        }, configurable:false, enumerable:false
    });

    this.html = new HtmlViewHelper(this);
    //class extension initiators
    if (typeof this.init === 'function') {
        //call init() method
        this.init();
    }
}
util.inherits(HttpViewContext, da.types.EventEmitter2);
/**
 * @param {String} url
 * @returns {string}
 */
HttpViewContext.prototype.render = function(url, callback) {
    callback = callback || function() {};
    var app = require('./index');
    //get response cookie, if any
    var requestCookie = this.context.response.getHeader('set-cookie');
    if (typeof this.context.request.headers.cookie !== 'undefined')
        requestCookie = this.context.request.headers.cookie;
    app.current.executeRequest( { url: url, cookie: requestCookie }, function(err, result) {
        if (err) {
            callback(err);
        }
        else {
            callback(null, result.body);
        }
    });
};

HttpViewContext.prototype.init = function() {
    //
};

/**
 *
 * @param {String} s
 * @param {String=} lib
 * @returns {String}
 */
HttpViewContext.prototype.translate = function(s, lib) {
    return this.context.translate(s, lib);
};
/**
 *
 * @param {String} s
 * @param {String=} lib
 * @returns {String}
 */
HttpViewContext.prototype.$T = function(s, lib) {
    return this.translate(s, lib);
};

/**
 * @param {HttpViewContext} $view
 * @returns {*}
 * @private
 */
HttpViewContext.HtmlViewHelper = function($view)
{
    var doc;
    return {
    antiforgery: function() {
        //create token
        var context = $view.context,  value = context.application.encypt(JSON.stringify({ id: Math.floor(Math.random() * 1000000), url:context.request.url, date:new Date() }));
        //try to set cookie
        context.response.setHeader('Set-Cookie','.CSRF='.concat(value));
        return $view.writer.writeAttribute('type', 'hidden')
            .writeAttribute('id', '_CSRFToken')
            .writeAttribute('name', '_CSRFToken')
            .writeAttribute('value', value)
            .writeFullBeginTag('input')
            .toString();
    },
    element: function(obj) {
        if (typeof doc === 'undefined') { doc = $view.context.application.document(); }
        return doc.parentWindow.angular.element(obj);
    },
    lang: function() {
        var context = $view.context, c= context.culture();
        if (typeof c === 'string') {
            if (c.length>=2) {
                return c.toLowerCase().substring(0,2);
            }
        }
        //in all cases return default culture
        return 'en';
    }
};
}

/**
 * @class
 * @param {HttpViewContext} view
 * @constructor
 * @property {HttpViewContext} parent - The parent HTTP View Context
 * @property {HTMLDocument|*} document - The in-process HTML Document
 * @memberOf module:most-web.mvc
 */
function HtmlViewHelper(view) {
    var document, self = this;
    Object.defineProperty(this, 'parent', {
        get: function() {
            return view;
        } , configurable:false, enumerable:false
    });
    Object.defineProperty(this, 'document', {
        get: function() {
            if (typeof document !== 'undefined') { return document; }
            document = self.view.context.application.document();
            return document;
        } , configurable:false, enumerable:false
    });
}
HtmlViewHelper.prototype.antiforgery = function() {
    var $view = this.parent;
    //create token
    var context = $view.context,  value = context.application.encypt(JSON.stringify({ id: Math.floor(Math.random() * 1000000), url:context.request.url, date:new Date() }));
    //try to set cookie
    context.response.setHeader('Set-Cookie','.CSRF='.concat(value));
    return $view.writer.writeAttribute('type', 'hidden')
        .writeAttribute('id', '_CSRFToken')
        .writeAttribute('name', '_CSRFToken')
        .writeAttribute('value', value)
        .writeFullBeginTag('input')
        .toString();
};

HtmlViewHelper.prototype.element = function(obj) {
    return this.document.parentWindow.angular.element(obj);
};

HtmlViewHelper.prototype.lang = function() {
    var $view = this.view;
    var context = $view.context, c= context.culture();
    if (typeof c === 'string') {
        if (c.length>=2) {
            return c.toLowerCase().substring(0,2);
        }
    }
    //in all cases return default culture
    return 'en';
};

/**
 * @namespace mvc
 * @memberOf module:most-web
 */
var mvc = {
    HttpResult : HttpResult,
    HttpContentResult : HttpContentResult,
    HttpJsonResult:HttpJsonResult,
    HttpEmptyResult:HttpEmptyResult,
    HttpXmlResult:HttpXmlResult,
    HttpRedirectResult:HttpRedirectResult,
    HttpFileResult:HttpFileResult,
    HttpViewResult:HttpViewResult,
    HttpViewContext:HttpViewContext,
    HtmlViewHelper:HtmlViewHelper,
    HttpController:HttpController,
    HttpViewEngine: HttpViewEngine,
    HttpViewEngineReference: HttpViewEngineReference
};

if (typeof exports !== 'undefined')
{
    module.exports = mvc;
}



</code></pre>
        </article>
    </section>




</div>

<br class="clear">


<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/angular.min.js"></script>
<script src="scripts/angular-route.min.js"></script>
<script src="scripts/layout.js"></script>

</body>
</html>
